ca65 V2.18 - N/A
Main file   : ./src/RTC Transmit.asm
Current file: ./src/RTC Transmit.asm

000000r 1               .setcpu "65C02"
000000r 1               .segment "CODE"
000000r 1               
000000r 1               RTC_SECS    = $8800
000000r 1               RTC_MINS    = $8801
000000r 1               RTC_HRS     = $8802
000000r 1               RTC_DAYS    = $8803
000000r 1               RTC_DATE    = $8804
000000r 1               RTC_MON     = $8805
000000r 1               RTC_YR      = $8806
000000r 1               RTC_CEN     = $8807
000000r 1               RTC_CTRLA   = $880E
000000r 1               RTC_CTRLB   = $880F
000000r 1               
000000r 1               ACIA_DATA   = $9000
000000r 1               ACIA_STATUS = $9001
000000r 1               ACIA_CMD    = $9002
000000r 1               ACIA_CTRL   = $9003
000000r 1               
000000r 1               reset:
000000r 1  A2 FF          ldx #$ff
000002r 1  9A             txs
000003r 1               
000003r 1  A9 00          lda #$00
000005r 1  8D 01 90       sta ACIA_STATUS ; Soft reset (value not important)
000008r 1               
000008r 1  A9 1F          lda #%00011111  ; N-8-1, 19200 baud
00000Ar 1  8D 03 90       sta ACIA_CTRL
00000Dr 1               
00000Dr 1  A9 0B          lda #%00001011  ; No parity, No echo, No interrupts
00000Fr 1  8D 02 90       sta ACIA_CMD
000012r 1               
000012r 1  AD 00 88       lda RTC_SECS
000015r 1  20 rr rr       jsr send_char
000018r 1  AD 01 88       lda RTC_MINS
00001Br 1  20 rr rr       jsr send_char
00001Er 1  AD 02 88       lda RTC_HRS
000021r 1  20 rr rr       jsr send_char
000024r 1  AD 03 88       lda RTC_DAYS
000027r 1  20 rr rr       jsr send_char
00002Ar 1  AD 04 88       lda RTC_DATE
00002Dr 1  20 rr rr       jsr send_char
000030r 1  AD 05 88       lda RTC_MON
000033r 1  20 rr rr       jsr send_char
000036r 1  AD 06 88       lda RTC_YR
000039r 1  20 rr rr       jsr send_char
00003Cr 1  AD 07 88       lda RTC_CEN
00003Fr 1  20 rr rr       jsr send_char
000042r 1  AD 0E 88       lda RTC_CTRLA
000045r 1  20 rr rr       jsr send_char
000048r 1  AD 0F 88       lda RTC_CTRLB
00004Br 1  20 rr rr       jsr send_char
00004Er 1               
00004Er 1  A9 80          lda #%10000000  ; Set transfer enable bit (start the clock)
000050r 1  8D 0F 88       sta RTC_CTRLB
000053r 1               
000053r 1               loop:
000053r 1  4C rr rr       jmp loop
000056r 1               
000056r 1               send_char:
000056r 1  8D 00 90       sta ACIA_DATA
000059r 1  48             pha
00005Ar 1               tx_wait:
00005Ar 1  AD 01 90       lda ACIA_STATUS
00005Dr 1  29 10          and #%00010000  ; Check if tx buffer not empty
00005Fr 1  F0 F9          beq tx_wait     ; Loop if tx buffer not empty
000061r 1  68             pla
000062r 1  60             rts
000063r 1               
000063r 1               .segment "VECTORS"
000000r 1               
000000r 1  rr rr          .word reset
000002r 1  rr rr          .word reset
000004r 1  rr rr          .word reset
000004r 1               
