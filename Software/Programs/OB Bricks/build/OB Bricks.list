ca65 V2.18 - N/A
Main file   : ./src/OB Bricks.asm
Current file: ./src/OB Bricks.asm

000000r 1               .setcpu "65C02"
000000r 1               
000000r 1               .include "../../../6502.inc"
000000r 2               ; ***                     ***
000000r 2               ; ***   6502 INCLUDES     ***
000000r 2               ; ***                     ***
000000r 2               
000000r 2               ; LCD Card | IO 1 | $8000-$800F
000000r 2               LCD_PORTB           = $8000
000000r 2               LCD_PORTA           = $8001
000000r 2               LCD_DDRB            = $8002
000000r 2               LCD_DDRA            = $8003
000000r 2               LCD_T1CL            = $8004
000000r 2               LCD_T1CH            = $8005
000000r 2               LCD_T1LL            = $8006
000000r 2               LCD_T1LH            = $8007
000000r 2               LCD_T2CL            = $8008
000000r 2               LCD_T2CH            = $8009
000000r 2               LCD_SR              = $800A
000000r 2               LCD_ACR             = $800B
000000r 2               LCD_PCR             = $800C
000000r 2               LCD_IFR             = $800D
000000r 2               LCD_IER             = $800E
000000r 2               LCD_ORA             = $800F
000000r 2               LCD_E               = %10000000
000000r 2               LCD_RW              = %01000000
000000r 2               LCD_RS              = %00100000
000000r 2               
000000r 2               ; RAM Card | IO 1 & 2 | $8000-$87FF
000000r 2               RAM_DATA            = $8000     ; R/W ($8000-$83FE)
000000r 2               RAM_DATA_H          = $8400     ; R/W ($8400-$87FE)
000000r 2               RAM_BANK            = $83FF     ; All three RAM_BANK addresses address the same bank switching
000000r 2               RAM_BANK_L          = $83FF     ; latch and can be univerally interchanged
000000r 2               RAM_BANK_H          = $87FF     ; RAM bank latch value ($00-$FF) sets which of 256 ~1K banks of RAM is selected in both H or L
000000r 2               
000000r 2               ; Emulator | IO 2 | $8400-$840F
000000r 2               EMU_SER_DATA        = $8400     ; Write
000000r 2               EMU_SER_CTRL        = $8401     ; Write
000000r 2               EMU_SER_STATUS      = $8401     ; Read
000000r 2               EMU_KB_CMD          = $8402     ; Write
000000r 2               EMU_KB_DATA         = $8402     ; Read
000000r 2               EMU_MOUSE_X         = $8403     ; Read
000000r 2               EMU_MOUSE_Y         = $8404     ; Read
000000r 2               EMU_MOUSE_W         = $8405     ; Read
000000r 2               EMU_MOUSE_BTNS      = $8406     ; Read
000000r 2               EMU_JOY_BTNS        = $8407     ; Read
000000r 2               EMU_RTC_SEC         = $8408     ; Read
000000r 2               EMU_RTC_MIN         = $8409     ; Read
000000r 2               EMU_RTC_HR          = $840A     ; Read
000000r 2               EMU_RTC_DAY         = $840B     ; Read
000000r 2               EMU_RTC_MON         = $840C     ; Read
000000r 2               EMU_RTC_YR          = $840D     ; Read
000000r 2               EMU_PRAM_DATA       = $840E     ; R/W
000000r 2               EMU_PRAM_ADDR       = $840F     ; R/W
000000r 2               
000000r 2               ; RTC Card | IO 3 | $8800-$881F
000000r 2               RTC_SEC             = $8800
000000r 2               RTC_MIN             = $8801
000000r 2               RTC_HR              = $8802
000000r 2               RTC_DAY             = $8803
000000r 2               RTC_DATE            = $8804
000000r 2               RTC_MON             = $8805
000000r 2               RTC_YR              = $8806
000000r 2               RTC_CENT            = $8807
000000r 2               RTC_ALARM_SEC       = $8808
000000r 2               RTC_ALARM_MIN       = $8809
000000r 2               RTC_ALARM_HR        = $880A
000000r 2               RTC_ALARM_DATE      = $880B
000000r 2               RTC_WD_L            = $880C
000000r 2               RTC_WD_H            = $880D
000000r 2               RTC_CTRL_A          = $880E
000000r 2               RTC_CTRL_B          = $880F
000000r 2               RTC_RAM_ADDR        = $8810
000000r 2               RTC_RAM_DATA        = $8813
000000r 2               
000000r 2               ; Storage Card | IO 4 | $8C00-$8C07
000000r 2               ST_DATA             = $8C00     ; R/W
000000r 2               ST_ERROR            = $8C01     ; Read
000000r 2               ST_FEATURE          = $8C01     ; Write
000000r 2               ST_SECT_CNT         = $8C02     ; R/W
000000r 2               ST_LBA_0            = $8C03     ; R/W
000000r 2               ST_LBA_1            = $8C04     ; R/W
000000r 2               ST_LBA_2            = $8C05     ; R/W
000000r 2               ST_LBA_3            = $8C06     ; R/W
000000r 2               ST_STATUS           = $8C07     ; Read
000000r 2               ST_CMD              = $8C07     ; Write
000000r 2               ST_ERR_AMNF         = %00000001
000000r 2               ST_ERR_ABRT         = %00000100
000000r 2               ST_ERR_IDNF         = %00010000
000000r 2               ST_ERR_UNC          = %01000000
000000r 2               ST_ERR_BBK          = %10000000
000000r 2               ST_STATUS_ERR       = %00000001
000000r 2               ST_STATUS_IDX       = %00000010
000000r 2               ST_STATUS_CORR      = %00000100
000000r 2               ST_STATUS_DRQ       = %00001000
000000r 2               ST_STATUS_DSC       = %00010000
000000r 2               ST_STATUS_DWF       = %00100000
000000r 2               ST_STATUS_RDY       = %01000000
000000r 2               ST_STATUS_BSY       = %10000000
000000r 2               
000000r 2               ; Serial Card | IO 5 | $9000-$9003
000000r 2               SC_DATA             = $9000     ; R/W
000000r 2               SC_RESET            = $9001     ; Write
000000r 2               SC_STATUS           = $9001     ; Read
000000r 2               SC_CMD              = $9002     ; R/W
000000r 2               SC_CTRL             = $9003     ; R/W
000000r 2               
000000r 2               ; GPIO Card / Input Board | IO 6 | $9400-$940F
000000r 2               GPIO_PORTB          = $9400
000000r 2               GPIO_PORTA          = $9401
000000r 2               GPIO_DDRB           = $9402
000000r 2               GPIO_DDRA           = $9403
000000r 2               GPIO_T1CL           = $9404
000000r 2               GPIO_T1CH           = $9405
000000r 2               GPIO_T1LL           = $9406
000000r 2               GPIO_T1LH           = $9407
000000r 2               GPIO_T2CL           = $9408
000000r 2               GPIO_T2CH           = $9409
000000r 2               GPIO_SR             = $940A
000000r 2               GPIO_ACR            = $940B
000000r 2               GPIO_PCR            = $940C
000000r 2               GPIO_IFR            = $940D
000000r 2               GPIO_IER            = $940E
000000r 2               GPIO_ORA            = $940F
000000r 2               
000000r 2               ; Sound Card | IO 7 | $9800-$980F
000000r 2               SND_PORTB           = $9400
000000r 2               SND_PORTA           = $9401
000000r 2               SND_DDRB            = $9402
000000r 2               SND_DDRA            = $9403
000000r 2               SND_T1CL            = $9404
000000r 2               SND_T1CH            = $9405
000000r 2               SND_T1LL            = $9406
000000r 2               SND_T1LH            = $9407
000000r 2               SND_T2CL            = $9408
000000r 2               SND_T2CH            = $9409
000000r 2               SND_SR              = $940A
000000r 2               SND_ACR             = $940B
000000r 2               SND_PCR             = $940C
000000r 2               SND_IFR             = $940D
000000r 2               SND_IER             = $940E
000000r 2               SND_ORA             = $940F
000000r 2               SND_BC1H            = %11100000   ; SND_PCR CA2
000000r 2               SND_BC1L            = %11000000   ; SND_PCR CA2
000000r 2               SND_BDIRH           = %00001110   ; SND_PCR CB2
000000r 2               SND_BDIRL           = %00001100   ; SND_PCR CB2
000000r 2               
000000r 2               ; Video Card / VGA Card | IO 8 | $9C00-$9C01
000000r 2               VC_DATA             = $9C00       ; R/WÃ¥
000000r 2               VC_REG              = $9C01       ; Write
000000r 2               VC_STATUS           = $9C01       ; Read
000000r 2               
000000r 2               ; VERA | IO 8 | $9C00-$9C0F
000000r 2               VERA_ADDR_LOW       = $9C00
000000r 2               VERA_ADDR_MID       = $9C01
000000r 2               VERA_ADDR_HIGH      = $9C02
000000r 2               VERA_DATA0          = $9C03
000000r 2               VERA_DATA1          = $9C04
000000r 2               VERA_CTRL           = $9C05
000000r 2               VERA_DC_VIDEO       = $9C09
000000r 2               VERA_DC_HSCALE      = $9C0A
000000r 2               VERA_DC_VSCALE      = $9C0B
000000r 2               VERA_DC_BORDER      = $9C0B
000000r 2               VERA_L0_CONFIG      = $9C0D
000000r 2               VERA_L0_MAPBASE     = $9C0E
000000r 2               VERA_L0_TILEBASE    = $9C0F
000000r 2               
000000r 1               
000000r 1               .segment "ZEROPAGE"
000000r 1               .segment "STACK"
000000r 1               .segment "INPUT_BUFFER"
000000r 1               .segment "KERNAL_VARS"
000000r 1               .segment "USER_VARS"
000000r 1               .segment "PROGRAM"
000000r 1               
000000r 1               ;*******************************************************************************
000000r 1               ; Build a 16x16 256 color tile in VRAM location $12000
000000r 1               ;*******************************************************************************
000000r 1  9C 05 9C         stz VERA_CTRL                       ; Use Data Register 0
000003r 1  A9 11            lda #$11
000005r 1  8D 02 9C         sta VERA_ADDR_HIGH                  ; Set Increment to 1, High Byte to 1
000008r 1  A9 20            lda #$20
00000Ar 1  8D 01 9C         sta VERA_ADDR_MID                   ; Set Middle Byte to $20
00000Dr 1  9C 00 9C         stz VERA_ADDR_LOW                   ; Set Low Byte to $00
000010r 1               
000010r 1  A2 00            ldx #0
000012r 1  BD rr rr     :   lda brick,x                         ; read from Brick Data
000015r 1  8D 03 9C         sta VERA_DATA0                      ; Write to VRAM with +1 Autoincrement
000018r 1  E8               inx
000019r 1  D0 F7            bne :-
00001Br 1               
00001Br 1               ;*******************************************************************************
00001Br 1               ; Configure Layer 0
00001Br 1               ;*******************************************************************************
00001Br 1  A9 03            lda #%00000011                      ; 32 x 32 tiles, 8 bits per pixel
00001Dr 1  8D 0D 9C         sta VERA_L0_CONFIG
000020r 1  A9 20            lda #$20                            ; $20 points to $4000 in VRAM
000022r 1  8D 0E 9C         sta VERA_L0_MAPBASE                  ; Store to Map Base Pointer
000025r 1               
000025r 1  A9 93            lda #$93                            ; $93 points to $12000, Width and Height 16 pixel
000027r 1  8D 0F 9C         sta VERA_L0_TILEBASE                ; Store to Tile Base Pointer
00002Ar 1               
00002Ar 1               ;*******************************************************************************
00002Ar 1               ; Fill the Layer 0 with all bricks
00002Ar 1               ;*******************************************************************************
00002Ar 1  9C 05 9C         stz VERA_CTRL                       ; Use Data Register 0
00002Dr 1  A9 10            lda #$10
00002Fr 1  8D 02 9C         sta VERA_ADDR_HIGH                  ; Set Increment to 1, High Byte to 0
000032r 1  A9 40            lda #$40
000034r 1  8D 01 9C         sta VERA_ADDR_MID                   ; Set Middle Byte to $40
000037r 1  9C 00 9C         stz VERA_ADDR_LOW                   ; Set Low Byte to $00
00003Ar 1               
00003Ar 1  A0 20            ldy #32
00003Cr 1  A9 00            lda #0
00003Er 1  A2 20        :   ldx #32
000040r 1  8D 03 9C     :   sta VERA_DATA0                      ; Write to VRAM with +1 Autoincrement
000043r 1  8D 03 9C         sta VERA_DATA0                      ; Write Attribute
000046r 1  CA               dex
000047r 1  D0 F7            bne :-
000049r 1  88               dey
00004Ar 1  D0 F2            bne :--
00004Cr 1               
00004Cr 1               ;*******************************************************************************
00004Cr 1               ; Turn on Layer 0
00004Cr 1               ;*******************************************************************************
00004Cr 1  A9 11            lda #%00010001                      ; Turn on layer 0, VGA Mode
00004Er 1  8D 09 9C         sta VERA_DC_VIDEO
000051r 1               
000051r 1               ;*******************************************************************************
000051r 1               ; Scale Display x2 for resolution of 320 x 240 pixels
000051r 1               ;*******************************************************************************
000051r 1  A9 40            lda #$40
000053r 1  8D 0A 9C         sta VERA_DC_HSCALE
000056r 1  8D 0B 9C         sta VERA_DC_VSCALE
000059r 1               
000059r 1               loop:
000059r 1  4C rr rr       jmp loop                             ; Halt
00005Cr 1               
00005Cr 1               brick:
00005Cr 1  08 08 08 08      .byte $08,$08,$08,$08,$08,$08,$08,$E5,$08,$08,$08,$08,$08,$08,$08,$08
000060r 1  08 08 08 E5  
000064r 1  08 08 08 08  
00006Cr 1  2A 2A 2A 2A      .byte $2A,$2A,$2A,$2A,$2A,$2A,$29,$E5,$08,$2A,$2A,$2A,$2A,$2A,$2A,$2A
000070r 1  2A 2A 29 E5  
000074r 1  08 2A 2A 2A  
00007Cr 1  2A 2A 2A 2A      .byte $2A,$2A,$2A,$2A,$2A,$2A,$29,$E5,$08,$2A,$2C,$2A,$2A,$2A,$2A,$2A
000080r 1  2A 2A 29 E5  
000084r 1  08 2A 2C 2A  
00008Cr 1  2A 2A 2C 2C      .byte $2A,$2A,$2C,$2C,$2A,$2A,$29,$E5,$08,$2A,$2A,$2A,$2A,$2A,$2A,$2A
000090r 1  2A 2A 29 E5  
000094r 1  08 2A 2A 2A  
00009Cr 1  2A 2A 2A 2A      .byte $2A,$2A,$2A,$2A,$2A,$2A,$29,$E5,$08,$2A,$2A,$2A,$2A,$2A,$2A,$2A
0000A0r 1  2A 2A 29 E5  
0000A4r 1  08 2A 2A 2A  
0000ACr 1  2A 2A 2A 2A      .byte $2A,$2A,$2A,$2A,$2A,$2A,$29,$E5,$08,$2A,$2A,$2A,$2A,$29,$29,$2A
0000B0r 1  2A 2A 29 E5  
0000B4r 1  08 2A 2A 2A  
0000BCr 1  29 29 29 29      .byte $29,$29,$29,$29,$29,$29,$29,$E5,$08,$29,$29,$29,$29,$29,$29,$29
0000C0r 1  29 29 29 E5  
0000C4r 1  08 29 29 29  
0000CCr 1  E5 E5 E5 E5      .byte $E5,$E5,$E5,$E5,$E5,$E5,$E5,$E5,$E5,$E5,$E5,$E5,$E5,$E5,$E5,$E5
0000D0r 1  E5 E5 E5 E5  
0000D4r 1  E5 E5 E5 E5  
0000DCr 1  E5 08 08 08      .byte $E5,$08,$08,$08,$08,$08,$08,$08,$08,$08,$08,$08,$08,$08,$08,$08
0000E0r 1  08 08 08 08  
0000E4r 1  08 08 08 08  
0000ECr 1  E5 08 08 2A      .byte $E5,$08,$08,$2A,$2C,$2C,$2A,$2A,$2A,$2A,$2A,$2A,$2A,$2A,$2A,$29
0000F0r 1  2C 2C 2A 2A  
0000F4r 1  2A 2A 2A 2A  
0000FCr 1  E5 08 2A 2A      .byte $E5,$08,$2A,$2A,$2A,$2A,$2A,$2A,$2A,$2A,$2A,$2A,$2A,$2A,$2A,$29
000100r 1  2A 2A 2A 2A  
000104r 1  2A 2A 2A 2A  
00010Cr 1  E5 08 2A 2A      .byte $E5,$08,$2A,$2A,$2A,$2A,$29,$29,$2A,$2A,$2A,$2A,$2A,$2A,$2A,$29
000110r 1  2A 2A 29 29  
000114r 1  2A 2A 2A 2A  
00011Cr 1  E5 08 2A 2A      .byte $E5,$08,$2A,$2A,$2A,$2A,$2A,$2A,$2A,$2A,$2A,$2A,$2A,$29,$2A,$29
000120r 1  2A 2A 2A 2A  
000124r 1  2A 2A 2A 2A  
00012Cr 1  E5 08 2A 2A      .byte $E5,$08,$2A,$2A,$2A,$2A,$2A,$2A,$2A,$2A,$2A,$2A,$2A,$2A,$2A,$29
000130r 1  2A 2A 2A 2A  
000134r 1  2A 2A 2A 2A  
00013Cr 1  E5 08 29 29      .byte $E5,$08,$29,$29,$29,$29,$29,$29,$29,$29,$29,$29,$29,$29,$29,$29
000140r 1  29 29 29 29  
000144r 1  29 29 29 29  
00014Cr 1  E5 E5 E5 E5      .byte $E5,$E5,$E5,$E5,$E5,$E5,$E5,$E5,$E5,$E5,$E5,$E5,$E5,$E5,$E5,$E5
000150r 1  E5 E5 E5 E5  
000154r 1  E5 E5 E5 E5  
00015Cr 1               
00015Cr 1               .segment "KERNAL"
000000r 1               .segment "CART"
000000r 1               .segment "WOZMON"
000000r 1               .segment "VECTORS"
000000r 1               
